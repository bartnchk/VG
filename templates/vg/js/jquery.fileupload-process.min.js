"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fileupload"],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?e(require("jquery"),require("./jquery.fileupload")):e(window.jQuery)}(function(e){var r=e.blueimp.fileupload.prototype.options.add;e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{processQueue:[],add:function(s,o){var t=e(this);o.process(function(){return t.fileupload("process",o)}),r.call(this,s,o)}},processActions:{},_processFile:function(r,s){var o=this,t=e.Deferred().resolveWith(o,[r]),i=t.promise();return this._trigger("process",null,r),e.each(r.processQueue,function(r,t){var n=function(r){return s.errorThrown?e.Deferred().rejectWith(o,[s]).promise():o.processActions[t.action].call(o,r,t)};i=i.then(n,t.always&&n)}),i.done(function(){o._trigger("processdone",null,r),o._trigger("processalways",null,r)}).fail(function(){o._trigger("processfail",null,r),o._trigger("processalways",null,r)}),i},_transformProcessQueue:function(r){var s=[];e.each(r.processQueue,function(){var o={},t=this.action,i=!0===this.prefix?t:this.prefix;e.each(this,function(s,t){"string"===e.type(t)&&"@"===t.charAt(0)?o[s]=r[t.slice(1)||(i?i+s.charAt(0).toUpperCase()+s.slice(1):s)]:o[s]=t}),s.push(o)}),r.processQueue=s},processing:function(){return this._processing},process:function(r){var s=this,o=e.extend({},this.options,r);return o.processQueue&&o.processQueue.length&&(this._transformProcessQueue(o),0===this._processing&&this._trigger("processstart"),e.each(r.files,function(t){var i=t?e.extend({},o):o,n=function(){return r.errorThrown?e.Deferred().rejectWith(s,[r]).promise():s._processFile(i,r)};i.index=t,s._processing+=1,s._processingQueue=s._processingQueue.then(n,n).always(function(){s._processing-=1,0===s._processing&&s._trigger("processstop")})})),this._processingQueue},_create:function(){this._super(),this._processing=0,this._processingQueue=e.Deferred().resolveWith(this).promise()}})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5maWxldXBsb2FkLXByb2Nlc3MuanMiXSwibmFtZXMiOlsiZmFjdG9yeSIsImRlZmluZSIsImFtZCIsImV4cG9ydHMiLCJfdHlwZW9mIiwicmVxdWlyZSIsIndpbmRvdyIsImpRdWVyeSIsIm9yaWdpbmFsQWRkIiwiJCIsImJsdWVpbXAiLCJmaWxldXBsb2FkIiwicHJvdG90eXBlIiwib3B0aW9ucyIsImFkZCIsIndpZGdldCIsInByb2Nlc3NRdWV1ZSIsIiR0aGlzIiwidGhpcyIsImNhbGwiLCJkYXRhIiwiZSIsInByb2Nlc3NBY3Rpb25zIiwiX3Byb2Nlc3NGaWxlIiwiY2hhaW4iLCJwcm9taXNlIiwib3JpZ2luYWxEYXRhIiwidGhhdCIsIl90cmlnZ2VyIiwiZWFjaCIsInNldHRpbmdzIiwiZnVuYyIsImVycm9yVGhyb3duIiwiRGVmZXJyZWQiLCJyZWplY3RXaXRoIiwidGhlbiIsImFsd2F5cyIsImFjdGlvbiIsImRvbmUiLCJmYWlsIiwiX3RyYW5zZm9ybVByb2Nlc3NRdWV1ZSIsInZhbHVlIiwicHJlZml4Iiwia2V5IiwidHlwZSIsImNoYXJBdCIsIl9wcm9jZXNzaW5nIiwidG9VcHBlckNhc2UiLCJzbGljZSIsInByb2Nlc3NpbmciLCJwcm9jZXNzIiwib3B0cyIsIl9wcm9jZXNzaW5nUXVldWUiLCJmaWxlcyIsImluZGV4IiwiZXh0ZW5kIiwiX2NyZWF0ZSIsIl9zdXBlciIsInJlc29sdmVXaXRoIl0sIm1hcHBpbmdzIjoib09BY0UsU0FBVUEsR0FGWixrQkFBQUMsU0FBQUEsT0FBQUMsSUFFRUQsUUFDRSxTQUtRLHVCQUpKRCxHQUNBLFlBQUEsbUJBQUFHLFNBQUEsWUFBQUMsUUFBQUQsVUFESkgsRUFPSUssUUFBQSxVQUNBTCxRQUNJSyx3QkFRUEwsRUFDSE0sT0FBYUMsU0FHWCxTQUFJQyxHQUdKLEdBQUFBLEdBQUFDLEVBQUFDLFFBQUFDLFdBQUFDLFVBQUFDLFFBQUFDLEdBSVFMLEdBQUFNLE9BQUEscUJBQUFOLEVBQUFDLFFBQUFDLFlBRUlFLFNBREpHLGdCQVdRRixJQUFBLFNBQU9HLEVBQUFBLEdBQ1YsR0FGREEsR0FBQVIsRUFBQVMsS0FHQVYsR0FBQUEsUUFBWVcsV0FDZixNQUFBRixHQUFBTixXQUFBLFVBQUFTLEtBREdaLEVBQVlXLEtBQUtELEtBQU1HLEVBQUdELEtBSWxDRSxrQkFXSUMsYUFFSUMsU0FBWUMsRUFGaEJDLEdBR0EsR0FBQUMsR0FBS0MsS0FDSEMsRUFBS1QsRUFBS0osV0FBQUEsWUFBY1csR0FBYUcsSUFDbkNOLEVBQUlPLEVBQU9OLFNBZ0NYLE9BL0JJUCxNQUFBVSxTQUFJRixVQUFhTSxLQUFBQSxHQUNidkIsRUFBQW9CLEtBQUFULEVBQUFKLGFBQVNpQixTQUNBQyxFQUFBQSxHQUNaLEdBQUFILEdBQUEsU0FBQVgsR0FDRCxNQUFBTSxHQUFZSixZQUxoQmIsRUFBQXdCLFdBV2NFLFdBQVdMLEdBQVNNLElBQWxDWCxVQUdNRSxFQUFBTCxlQUFZUSxFQUFBTyxRQUFBbEIsS0FDVFMsRUFDQUEsRUFFSEUsR0FMVk4sR0FBQUEsRUFBQVcsS0FBQUosRUFBQUQsRUFBQU0sUUFBQUwsS0FsRDZDUCxFQW1EeENjLEtBQUssV0FXZFgsRUFBQUMsU0FBQSxjQUFBLEtBQUFSLEdBQ0FPLEVBQUFDLFNBQUEsZ0JBQUEsS0FBQVIsS0FFQW1CLEtBQUEsV0FDQUMsRUFBQUEsU0FBd0IsY0FBQSxLQUFBcEIsR0FDaEJKLEVBQUFBLFNBQUosZ0JBQUEsS0FBQUksS0FFSUksR0FXUU0sdUJBQUFBLFNBQWdCVyxHQUNuQixHQUFBekIsS0FFSlAsR0FBQW9CLEtBWERoQixFQUFBRyxhQUFBLFdBWUFBLEdBQUFBLE1BaEJKcUIsRUFBQW5CLEtBQUFtQixPQWtCUXJCLEdBQWVBLElBQWZBLEtBQVIwQixPQUFBTCxFQUFBbkIsS0FBQXdCLE1BdEY2Q2pDLEdBQUFvQixLQUFBWCxLQUFBLFNBQUF5QixFQUFBRixHQXlFZixXQUFsQmhDLEVBQUVtQyxLQUFLSCxJQWdCdkIsTUFBQUEsRUFBQUksT0FBQSxHQUNZZixFQUFBYSxHQUFBOUIsRUFDSWlDLEVBQUFBLE1BQVosS0FBQUosRUFBQUEsRUEzRjZDQyxFQUFBRSxPQUFBLEdBQUFFLGNBQUFKLEVBQUFLLE1BQUEsR0FBQUwsSUErRmpEYixFQUFBYSxHQUFBRixJQUlRNUIsRUFBUUcsS0FBQUEsS0FFUkgsRUFBSUcsYUFBSzhCLEdBSUxHLFdBQUEsV0FBQSxNQUFBL0IsTUFDSWEsYUFNQ21CLFFBQUEsU0FQTDlCLEdBUUErQixHQUFBQSxHQUFBQSxLQUNBeEIsRUFBS21CLEVBQUFBLFVBQUw1QixLQUFBTCxRQUFBTyxFQVVSLE9BVFFPLEdBQUFBLGNBQUt5QixFQUFtQnpCLGFBQUt5QixTQUVyQnpCLEtBQUFBLHVCQUFvQmQsR0FDWGlDLElBQVQ1QixLQUFBNEIsYUFDSW5CLEtBQUFBLFNBQUtDLGdCQUVabkIsRUFBQW9CLEtBTkxULEVBQUFpQyxNQUFBLFNBQUFDLEdBWEosR0FBQUgsR0FBQUcsRUFBQTdDLEVBQUE4QyxVQUFBMUMsR0FBQUEsRUFtQkhrQixFQUFBLFdBQ1dxQixNQUFBQSxHQUFBQSxZQTVIaUMzQyxFQUFBd0IsV0E2R2hCQyxXQUFXUCxHQUFPUCxJQUFPSyxVQW1CdERFLEVBQUFKLGFBQUE0QixFQUFBL0IsR0FFS2dDLEdBQUFBLE1BQUxFLEVBRUgzQixFQUFBbUIsYUFBQSxFQWpCV25CLEVBQUt5QixpQkFBbUJ6QixFQUFLeUIsaUJBQWlCakIsS0FBS0osRUFBTUEsR0FuSHpFSyxPQUFBLFdBM0JIVCxFQUFBbUIsYUFBQSxFQWlKb0QsSUFBckJuQixFQUFLbUIsYUFDTG5CLEVBQUtDLFNBQVMsb0JBSzNCVixLQUFLa0Msa0JBR2hCSSxRQUFTLFdBQ0x0QyxLQUFLdUMsU0FDTHZDLEtBQUs0QixZQUFjLEVBQ25CNUIsS0FBS2tDLGlCQUFtQjNDLEVBQUV3QixXQUFXeUIsWUFBWXhDLE1BQzVDTyIsImZpbGUiOiJqcXVlcnkuZmlsZXVwbG9hZC1wcm9jZXNzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBqUXVlcnkgRmlsZSBVcGxvYWQgUHJvY2Vzc2luZyBQbHVnaW5cbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ibHVlaW1wL2pRdWVyeS1GaWxlLVVwbG9hZFxuICpcbiAqIENvcHlyaWdodCAyMDEyLCBTZWJhc3RpYW4gVHNjaGFuXG4gKiBodHRwczovL2JsdWVpbXAubmV0XG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlOlxuICogaHR0cHM6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqL1xuXG4vKiBqc2hpbnQgbm9tZW46ZmFsc2UgKi9cbi8qIGdsb2JhbCBkZWZpbmUsIHJlcXVpcmUsIHdpbmRvdyAqL1xuXG47KGZ1bmN0aW9uIChmYWN0b3J5KSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgLy8gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIEFNRCBtb2R1bGU6XG4gICAgICAgIGRlZmluZShbXG4gICAgICAgICAgICAnanF1ZXJ5JyxcbiAgICAgICAgICAgICcuL2pxdWVyeS5maWxldXBsb2FkJ1xuICAgICAgICBdLCBmYWN0b3J5KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgICAgICAvLyBOb2RlL0NvbW1vbkpTOlxuICAgICAgICBmYWN0b3J5KFxuICAgICAgICAgICAgcmVxdWlyZSgnanF1ZXJ5JyksXG4gICAgICAgICAgICByZXF1aXJlKCcuL2pxdWVyeS5maWxldXBsb2FkJylcbiAgICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBCcm93c2VyIGdsb2JhbHM6XG4gICAgICAgIGZhY3RvcnkoXG4gICAgICAgICAgICB3aW5kb3cualF1ZXJ5XG4gICAgICAgICk7XG4gICAgfVxufShmdW5jdGlvbiAoJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBvcmlnaW5hbEFkZCA9ICQuYmx1ZWltcC5maWxldXBsb2FkLnByb3RvdHlwZS5vcHRpb25zLmFkZDtcblxuICAgIC8vIFRoZSBGaWxlIFVwbG9hZCBQcm9jZXNzaW5nIHBsdWdpbiBleHRlbmRzIHRoZSBmaWxldXBsb2FkIHdpZGdldFxuICAgIC8vIHdpdGggZmlsZSBwcm9jZXNzaW5nIGZ1bmN0aW9uYWxpdHk6XG4gICAgJC53aWRnZXQoJ2JsdWVpbXAuZmlsZXVwbG9hZCcsICQuYmx1ZWltcC5maWxldXBsb2FkLCB7XG5cbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgLy8gVGhlIGxpc3Qgb2YgcHJvY2Vzc2luZyBhY3Rpb25zOlxuICAgICAgICAgICAgcHJvY2Vzc1F1ZXVlOiBbXG4gICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2xvZycsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkZWJ1ZydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uIChlLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICBkYXRhLnByb2Nlc3MoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMuZmlsZXVwbG9hZCgncHJvY2VzcycsIGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIG9yaWdpbmFsQWRkLmNhbGwodGhpcywgZSwgZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcHJvY2Vzc0FjdGlvbnM6IHtcbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZVtvcHRpb25zLnR5cGVdKFxuICAgICAgICAgICAgICAgICAgICAnUHJvY2Vzc2luZyBcIicgKyBkYXRhLmZpbGVzW2RhdGEuaW5kZXhdLm5hbWUgKyAnXCInXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICovXG4gICAgICAgIH0sXG5cbiAgICAgICAgX3Byb2Nlc3NGaWxlOiBmdW5jdGlvbiAoZGF0YSwgb3JpZ2luYWxEYXRhKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgZGZkID0gJC5EZWZlcnJlZCgpLnJlc29sdmVXaXRoKHRoYXQsIFtkYXRhXSksXG4gICAgICAgICAgICAgICAgY2hhaW4gPSBkZmQucHJvbWlzZSgpO1xuICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigncHJvY2VzcycsIG51bGwsIGRhdGEpO1xuICAgICAgICAgICAgJC5lYWNoKGRhdGEucHJvY2Vzc1F1ZXVlLCBmdW5jdGlvbiAoaSwgc2V0dGluZ3MpIHtcbiAgICAgICAgICAgICAgICB2YXIgZnVuYyA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcmlnaW5hbERhdGEuZXJyb3JUaHJvd24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkLkRlZmVycmVkKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlamVjdFdpdGgodGhhdCwgW29yaWdpbmFsRGF0YV0pLnByb21pc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC5wcm9jZXNzQWN0aW9uc1tzZXR0aW5ncy5hY3Rpb25dLmNhbGwoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjaGFpbiA9IGNoYWluLnRoZW4oZnVuYywgc2V0dGluZ3MuYWx3YXlzICYmIGZ1bmMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjaGFpblxuICAgICAgICAgICAgICAgIC5kb25lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fdHJpZ2dlcigncHJvY2Vzc2RvbmUnLCBudWxsLCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fdHJpZ2dlcigncHJvY2Vzc2Fsd2F5cycsIG51bGwsIGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmZhaWwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll90cmlnZ2VyKCdwcm9jZXNzZmFpbCcsIG51bGwsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll90cmlnZ2VyKCdwcm9jZXNzYWx3YXlzJywgbnVsbCwgZGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gY2hhaW47XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gUmVwbGFjZXMgdGhlIHNldHRpbmdzIG9mIGVhY2ggcHJvY2Vzc1F1ZXVlIGl0ZW0gdGhhdFxuICAgICAgICAvLyBhcmUgc3RyaW5ncyBzdGFydGluZyB3aXRoIGFuIFwiQFwiLCB1c2luZyB0aGUgcmVtYWluaW5nXG4gICAgICAgIC8vIHN1YnN0cmluZyBhcyBrZXkgZm9yIHRoZSBvcHRpb24gbWFwLFxuICAgICAgICAvLyBlLmcuIFwiQGF1dG9VcGxvYWRcIiBpcyByZXBsYWNlZCB3aXRoIG9wdGlvbnMuYXV0b1VwbG9hZDpcbiAgICAgICAgX3RyYW5zZm9ybVByb2Nlc3NRdWV1ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIHZhciBwcm9jZXNzUXVldWUgPSBbXTtcbiAgICAgICAgICAgICQuZWFjaChvcHRpb25zLnByb2Nlc3NRdWV1ZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHt9LFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSB0aGlzLmFjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgcHJlZml4ID0gdGhpcy5wcmVmaXggPT09IHRydWUgPyBhY3Rpb24gOiB0aGlzLnByZWZpeDtcbiAgICAgICAgICAgICAgICAkLmVhY2godGhpcywgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQudHlwZSh2YWx1ZSkgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuY2hhckF0KDApID09PSAnQCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzW2tleV0gPSBvcHRpb25zW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNsaWNlKDEpIHx8IChwcmVmaXggPyBwcmVmaXggK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBrZXkuc2xpY2UoMSkgOiBrZXkpXG4gICAgICAgICAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Nba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBwcm9jZXNzUXVldWUucHVzaChzZXR0aW5ncyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG9wdGlvbnMucHJvY2Vzc1F1ZXVlID0gcHJvY2Vzc1F1ZXVlO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBmaWxlcyBjdXJyZW50bHkgaW4gdGhlIHByb2Nlc3NzaW5nIHF1ZXVlOlxuICAgICAgICBwcm9jZXNzaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvY2Vzc2luZztcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBQcm9jZXNzZXMgdGhlIGZpbGVzIGdpdmVuIGFzIGZpbGVzIHByb3BlcnR5IG9mIHRoZSBkYXRhIHBhcmFtZXRlcixcbiAgICAgICAgLy8gcmV0dXJucyBhIFByb21pc2Ugb2JqZWN0IHRoYXQgYWxsb3dzIHRvIGJpbmQgY2FsbGJhY2tzOlxuICAgICAgICBwcm9jZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCBkYXRhKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnByb2Nlc3NRdWV1ZSAmJiBvcHRpb25zLnByb2Nlc3NRdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90cmFuc2Zvcm1Qcm9jZXNzUXVldWUob3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Byb2Nlc3NpbmcgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcigncHJvY2Vzc3N0YXJ0Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLmZpbGVzLCBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdHMgPSBpbmRleCA/ICQuZXh0ZW5kKHt9LCBvcHRpb25zKSA6IG9wdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmVycm9yVGhyb3duKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkLkRlZmVycmVkKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVqZWN0V2l0aCh0aGF0LCBbZGF0YV0pLnByb21pc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQuX3Byb2Nlc3NGaWxlKG9wdHMsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgb3B0cy5pbmRleCA9IGluZGV4O1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9wcm9jZXNzaW5nICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3Byb2Nlc3NpbmdRdWV1ZSA9IHRoYXQuX3Byb2Nlc3NpbmdRdWV1ZS50aGVuKGZ1bmMsIGZ1bmMpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWx3YXlzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9wcm9jZXNzaW5nIC09IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuX3Byb2Nlc3NpbmcgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fdHJpZ2dlcigncHJvY2Vzc3N0b3AnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9jZXNzaW5nUXVldWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3NpbmcgPSAwO1xuICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc2luZ1F1ZXVlID0gJC5EZWZlcnJlZCgpLnJlc29sdmVXaXRoKHRoaXMpXG4gICAgICAgICAgICAgICAgLnByb21pc2UoKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbn0pKTtcbiJdfQ==
